<!DOCTYPE html>
<html>
<head>
    <title>检查项目库</title>
    {% include 'system/common/header.html' %}
</head>
<body class="pear-container">
<div class="layui-card">
    <div class="layui-card-body">
        <form class="layui-form" lay-filter="examlib-query-form">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">检查名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="ExamName" placeholder="请输入检查名称" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">患者姓名</label>
                    <div class="layui-input-inline">
                        <input type="text" name="Name" placeholder="请输入患者姓名" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <button class="pear-btn pear-btn-md pear-btn-primary" lay-submit lay-filter="examlib-query">
                        <i class="layui-icon layui-icon-search"></i>查询
                    </button>
                    <button type="reset" class="pear-btn pear-btn-md">
                        <i class="layui-icon layui-icon-refresh"></i>重置
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="layui-card">
    <div class="layui-card-body">
        <table id="examlib-table" lay-filter="examlib-table"></table>
    </div>
</div>

<script type="text/html" id="examlib-toolbar">
    {% if authorize("system:examlib:add") %}
    <button class="pear-btn pear-btn-primary pear-btn-md" lay-event="add">
        <i class="pear-icon pear-icon-add"></i>新增
    </button>
    {% endif %}
</script>

<script type="text/html" id="examlib-bar">
    {% if authorize("system:examlib:edit") %}
    <button class="pear-btn pear-btn-primary pear-btn-sm" lay-event="edit">
        <i class="pear-icon pear-icon-edit"></i>编辑
    </button>
    {% endif %}
    {% if authorize("system:examlib:remove") %}
    <button class="pear-btn pear-btn-danger pear-btn-sm" lay-event="remove">
        <i class="pear-icon pear-icon-ashbin"></i>删除
    </button>
    {% endif %}
</script>

{% include 'system/common/footer.html' %}
<script>
layui.use(['table','form','jquery','popup'], function () {
    let table = layui.table
    let form = layui.form
    let $ = layui.jquery
    let popup = layui.popup
    let MODULE_PATH = "{{ url_for('system.examlib.main') }}"

    table.render({
        elem: '#examlib-table',
        url: MODULE_PATH + 'data',
        page: true,
        skin: 'line',
        toolbar: '#examlib-toolbar',
        height: 'full-180',
        defaultToolbar: [{layEvent: 'refresh', icon: 'layui-icon-refresh'}, 'filter', 'print', 'exports'],
        cols: [[
            {title: '患者编号', field: 'PatientNo', align: 'center', width: 120},
            {title: '患者姓名', field: 'Name', align: 'center', width: 120},
            {title: '检查名称', field: 'ExamName', align: 'center'},
            {title: '备注', field: 'Remarks', align: 'center'},
            {title: '创建时间', field: 'CreateDate', align: 'center', width: 180},
            {title: '更新时间', field: 'ModifyDate', align: 'center', width: 180},
            {title: '操作', toolbar: '#examlib-bar', align: 'center', width: 260}
        ]]
    })

    form.on('submit(examlib-query)', function (data) {
        table.reload('examlib-table', {where: data.field})
        return false
    })

    table.on('tool(examlib-table)', function (obj) {
        if (obj.event === 'edit') {
            window.edit(obj)
        } else if (obj.event === 'remove') {
            window.remove(obj)
        }
    })

    table.on('toolbar(examlib-table)', function (obj) {
        if (obj.event === 'add') {
            window.add()
        } else if (obj.event === 'refresh') {
            table.reload('examlib-table')
        }
    })

    window.add = function () {
        layer.open({
            type: 2,
            title: '新增检查项目',
            shade: 0.1,
            area: ['600px', '500px'],
            content: MODULE_PATH + 'add'
        })
    }

    window.edit = function (obj) {
        layer.open({
            type: 2,
            title: '编辑检查项目',
            shade: 0.1,
            area: ['600px', '500px'],
            content: MODULE_PATH + 'edit/' + obj.data['ExamID']
        })
    }

    window.remove = function (obj) {
        layer.confirm('确定要删除该检查项目吗？', {icon: 3, title: '提示'}, function (index) {
            layer.close(index)
            let loading = layer.load()
            $.ajax({
                url: MODULE_PATH + 'remove/' + obj.data['ExamID'],
                type: 'delete',
                success: function (result) {
                    layer.close(loading)
                    if (result.success) {
                        popup.success(result.msg, function () {
                            obj.del()
                        })
                    } else {
                        popup.failure(result.msg)
                    }
                }
            })
        })
    }
})
</script>
</body>
</html>
